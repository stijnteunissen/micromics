<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate Beta Diversity Ordination Plots — beta_diversity • micromics</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate Beta Diversity Ordination Plots — beta_diversity"><meta name="description" content="This function computes beta diversity using ordination methods (e.g., PCoA) on a phyloseq object and generates corresponding ordination plots. It supports both ASV-level data and data aggregated at various taxonomic levels, and it can handle both relative and, if available, absolute abundance data. Four distance metrics are used for relative abundance plots (Jaccard, Bray-Curtis, Unweighted UniFrac, and Weighted UniFrac), and Manhattan distance is used for absolute abundance plots when a normalization method is provided."><meta property="og:description" content="This function computes beta diversity using ordination methods (e.g., PCoA) on a phyloseq object and generates corresponding ordination plots. It supports both ASV-level data and data aggregated at various taxonomic levels, and it can handle both relative and, if available, absolute abundance data. Four distance metrics are used for relative abundance plots (Jaccard, Bray-Curtis, Unweighted UniFrac, and Weighted UniFrac), and Manhattan distance is used for absolute abundance plots when a normalization method is provided."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">micromics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stijnteunissen/micromics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generate Beta Diversity Ordination Plots</h1>
      <small class="dont-index">Source: <a href="https://github.com/stijnteunissen/micromics/blob/master/R/beta_diversity.R" class="external-link"><code>R/beta_diversity.R</code></a></small>
      <div class="d-none name"><code>beta_diversity.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function computes beta diversity using ordination methods (e.g., PCoA) on a phyloseq object and generates corresponding ordination plots. It supports both ASV-level data and data aggregated at various taxonomic levels, and it can handle both relative and, if available, absolute abundance data. Four distance metrics are used for relative abundance plots (Jaccard, Bray-Curtis, Unweighted UniFrac, and Weighted UniFrac), and Manhattan distance is used for absolute abundance plots when a normalization method is provided.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">beta_diversity</span><span class="op">(</span></span>
<span>  physeq <span class="op">=</span> <span class="va">physeq</span>,</span>
<span>  taxrank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>, <span class="st">"Family"</span>, <span class="st">"Genus"</span><span class="op">)</span>,</span>
<span>  norm_method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ordination_method <span class="op">=</span> <span class="st">"PCoA"</span>,</span>
<span>  color_factor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  color_continuous <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  shape_factor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  size_factor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alpha_factor <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-physeq">physeq<a class="anchor" aria-label="anchor" href="#arg-physeq"></a></dt>
<dd><p>A phyloseq object containing microbial community data.</p></dd>


<dt id="arg-taxrank">taxrank<a class="anchor" aria-label="anchor" href="#arg-taxrank"></a></dt>
<dd><p>A character vector specifying the taxonomic levels to process. If the first element (case-insensitive) is <code>"asv"</code>, ASV-level beta diversity is computed; otherwise, beta diversity is computed for each taxonomic level provided (default: <code>c("Phylum", "Class", "Order", "Family", "Genus")</code>).</p></dd>


<dt id="arg-norm-method">norm_method<a class="anchor" aria-label="anchor" href="#arg-norm-method"></a></dt>
<dd><p>A character string indicating the normalization method to be used for generating absolute abundance data. Options include:</p><ul><li><p><code>"fcm"</code>: Flow cytometry normalization.</p></li>
<li><p><code>"qpcr"</code>: qPCR normalization.</p></li>
<li><p><code>NULL</code>: No absolute abundance processing (default).</p></li>
</ul></dd>


<dt id="arg-ordination-method">ordination_method<a class="anchor" aria-label="anchor" href="#arg-ordination-method"></a></dt>
<dd><p>A character string specifying the ordination method to use (default is <code>"PCoA"</code>).</p></dd>


<dt id="arg-color-factor">color_factor<a class="anchor" aria-label="anchor" href="#arg-color-factor"></a></dt>
<dd><p>An optional character string specifying the sample metadata column used to color the points in the ordination plot.</p></dd>


<dt id="arg-color-continuous">color_continuous<a class="anchor" aria-label="anchor" href="#arg-color-continuous"></a></dt>
<dd><p>A logical value indicating whether the color scale should be continuous (<code>TRUE</code>) or discrete (<code>FALSE</code>). Default is <code>TRUE</code>.</p></dd>


<dt id="arg-shape-factor">shape_factor<a class="anchor" aria-label="anchor" href="#arg-shape-factor"></a></dt>
<dd><p>An optional character string specifying the sample metadata column used to assign point shapes in the ordination plot.</p></dd>


<dt id="arg-size-factor">size_factor<a class="anchor" aria-label="anchor" href="#arg-size-factor"></a></dt>
<dd><p>An optional character string specifying the sample metadata column used to assign point sizes in the ordination plot.</p></dd>


<dt id="arg-alpha-factor">alpha_factor<a class="anchor" aria-label="anchor" href="#arg-alpha-factor"></a></dt>
<dd><p>An optional character string specifying the sample metadata column used to assign point transparency in the ordination plot.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A ggplot object representing the combined beta diversity ordination plot for the relative (and, if applicable, absolute) data.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function performs the following steps:</p><ol><li><p>Sets up project directories and folder paths for saving output files.</p></li>
<li><p>Defines an internal helper function, <code>base_beta_plot</code>, which performs the ordination (using the specified <code>ordination_method</code> and distance metric), removes default point layers, and then adds a customized geom_point layer with aesthetics defined by the provided factors.</p></li>
<li><p>For ASV-level data (when <code>taxrank[1]</code> is <code>"asv"</code>):</p><ul><li><p>Processes relative abundance data (transformed to percentages) and, if a normalization method is specified, also processes absolute abundance data.</p></li>
<li><p>Generates ordination plots using multiple distance metrics:</p><ul><li><p><strong>Jaccard</strong>: Based on binary presence/absence.</p></li>
<li><p><strong>Bray-Curtis</strong>: Incorporates both presence and abundance.</p></li>
<li><p><strong>Unweighted UniFrac</strong>: Considers lineage presence only.</p></li>
<li><p><strong>Weighted UniFrac</strong>: Considers both lineage presence and abundance.</p></li>
</ul></li>
<li><p>If both DNA and RNA data are present, separate plots are generated for each.</p></li>
</ul></li>
<li><p>For other taxonomic levels:</p><ul><li><p>Similar processing is performed for each taxonomic rank, with output saved in dedicated subfolders.</p></li>
</ul></li>
<li><p>Aesthetic scales (colors, shapes, sizes, alpha) are defined based on the unique levels in the sample data.</p></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="co"># Example: Generate beta diversity plots at the ASV level using PCoA ordination and flow cytometry normalization</span></span></span>
<span class="r-in"><span>  <span class="va">beta_plot</span> <span class="op">&lt;-</span> <span class="fu">beta_diversity</span><span class="op">(</span></span></span>
<span class="r-in"><span>    physeq <span class="op">=</span> <span class="va">my_physeq</span>,</span></span>
<span class="r-in"><span>    taxrank <span class="op">=</span> <span class="st">"asv"</span>,</span></span>
<span class="r-in"><span>    norm_method <span class="op">=</span> <span class="st">"fcm"</span>,</span></span>
<span class="r-in"><span>    ordination_method <span class="op">=</span> <span class="st">"PCoA"</span>,</span></span>
<span class="r-in"><span>    color_factor <span class="op">=</span> <span class="st">"Treatment"</span>,</span></span>
<span class="r-in"><span>    shape_factor <span class="op">=</span> <span class="st">"Replica"</span>,</span></span>
<span class="r-in"><span>    size_factor <span class="op">=</span> <span class="st">"Timepoint"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Example: Generate beta diversity plots for Phylum and Class levels without absolute data processing</span></span></span>
<span class="r-in"><span>  <span class="va">beta_plot</span> <span class="op">&lt;-</span> <span class="fu">beta_diversity</span><span class="op">(</span></span></span>
<span class="r-in"><span>    physeq <span class="op">=</span> <span class="va">my_physeq</span>,</span></span>
<span class="r-in"><span>    taxrank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Phylum"</span>, <span class="st">"Class"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    norm_method <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>    ordination_method <span class="op">=</span> <span class="st">"PCoA"</span>,</span></span>
<span class="r-in"><span>    color_factor <span class="op">=</span> <span class="st">"Soil_Type"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Stijn Teunissen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

