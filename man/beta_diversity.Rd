% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/beta_diversity.R
\name{beta_diversity}
\alias{beta_diversity}
\title{Generate Beta Diversity Ordination Plots}
\usage{
beta_diversity(
  physeq = physeq,
  taxrank = c("Phylum", "Class", "Order", "Family", "Tax_label"),
  norm_method = NULL,
  ordination_method = "PCoA",
  color_factor = NULL,
  color_continuous = TRUE,
  shape_factor = NULL,
  size_factor = NULL,
  alpha_factor = NULL
)
}
\arguments{
\item{physeq}{A phyloseq object containing microbial community data.}

\item{taxrank}{A character vector specifying the taxonomic levels to process. If the first element (case-insensitive) is \code{"asv"}, ASV-level beta diversity is computed; otherwise, beta diversity is computed for each taxonomic level provided (default: \code{c("Phylum", "Class", "Order", "Family", "Tax_label")}).}

\item{norm_method}{A character string indicating the normalization method to be used for generating absolute abundance data. Options include:
\itemize{
\item \code{"fcm"}: Flow cytometry normalization.
\item \code{"qpcr"}: qPCR normalization.
\item \code{NULL}: No absolute abundance processing (default).
}}

\item{ordination_method}{A character string specifying the ordination method to use (default is \code{"PCoA"}).}

\item{color_factor}{An optional character string specifying the sample metadata column used to color the points in the ordination plot.}

\item{color_continuous}{A logical value indicating whether the color scale should be continuous (\code{TRUE}) or discrete (\code{FALSE}). Default is \code{TRUE}.}

\item{shape_factor}{An optional character string specifying the sample metadata column used to assign point shapes in the ordination plot.}

\item{size_factor}{An optional character string specifying the sample metadata column used to assign point sizes in the ordination plot.}

\item{alpha_factor}{An optional character string specifying the sample metadata column used to assign point transparency in the ordination plot.}
}
\value{
A ggplot object representing the combined beta diversity ordination plot for the relative (and, if applicable, absolute) data.
}
\description{
This function computes beta diversity using ordination methods (e.g., PCoA) on a phyloseq object and generates corresponding ordination plots. It supports both ASV-level data and data aggregated at various taxonomic levels, and it can handle both relative and, if available, absolute abundance data. Four distance metrics are used for relative abundance plots (Jaccard, Bray-Curtis, Unweighted UniFrac, and Weighted UniFrac), and Manhattan distance is used for absolute abundance plots when a normalization method is provided.
}
\details{
The function performs the following steps:
\enumerate{
\item Sets up project directories and folder paths for saving output files.
\item Defines an internal helper function, \code{base_beta_plot}, which performs the ordination (using the specified \code{ordination_method} and distance metric), removes default point layers, and then adds a customized geom_point layer with aesthetics defined by the provided factors.
\item For ASV-level data (when \code{taxrank[1]} is \code{"asv"}):
\itemize{
\item Processes relative abundance data (transformed to percentages) and, if a normalization method is specified, also processes absolute abundance data.
\item Generates ordination plots using multiple distance metrics:
\itemize{
\item \strong{Jaccard}: Based on binary presence/absence.
\item \strong{Bray-Curtis}: Incorporates both presence and abundance.
\item \strong{Unweighted UniFrac}: Considers lineage presence only.
\item \strong{Weighted UniFrac}: Considers both lineage presence and abundance.
}
\item If both DNA and RNA data are present, separate plots are generated for each.
}
\item For other taxonomic levels:
\itemize{
\item Similar processing is performed for each taxonomic rank, with output saved in dedicated subfolders.
}
\item Aesthetic scales (colors, shapes, sizes, alpha) are defined based on the unique levels in the sample data.
}
}
\examples{
\dontrun{
  # Example: Generate beta diversity plots at the ASV level using PCoA ordination and flow cytometry normalization
  beta_plot <- beta_diversity(
    physeq = my_physeq,
    taxrank = "asv",
    norm_method = "fcm",
    ordination_method = "PCoA",
    color_factor = "Treatment",
    shape_factor = "Replica",
    size_factor = "Timepoint"
  )

  # Example: Generate beta diversity plots for Phylum and Class levels without absolute data processing
  beta_plot <- beta_diversity(
    physeq = my_physeq,
    taxrank = c("Phylum", "Class"),
    norm_method = NULL,
    ordination_method = "PCoA",
    color_factor = "Soil_Type"
  )
}

}
